package edu.javeriana.cad.instanceList;

import java.nio.charset.StandardCharsets;
import java.nio.file.Files;
import java.nio.file.Path;
import java.nio.file.Paths;
import java.nio.file.StandardOpenOption;
import java.util.ArrayList;
import java.util.List;

import org.apache.commons.lang3.StringUtils;

import com.fasterxml.jackson.databind.ObjectMapper;

import edu.javeriana.cad.instanceList.beans.AwsPriceElement;

/**
 * Clase utilitaria que procesa la salida de precios del comando de precios de AWS 
 * @author FelipeReyesPalacio
 *
 */
public class ProcessAwsV1PricesText {

	public static final String TEXT_PRUEBA = "{\"product\":{\"productFamily\":\"Compute Instance\",\"attributes\":{\"enhancedNetworkingSupported\":\"Yes\",\"intelTurboAvailable\":\"No\",\"memory\":\"64 GiB\",\"dedicatedEbsThroughput\":\"4500 Mbps\",\"vcpu\":\"16\",\"classicnetworkingsupport\":\"false\",\"capacitystatus\":\"Used\",\"locationType\":\"AWS Region\",\"storage\":\"1 x 950 NVMe SSD\",\"instanceFamily\":\"General purpose\",\"operatingSystem\":\"Linux\",\"intelAvx2Available\":\"No\",\"regionCode\":\"us-east-2\",\"physicalProcessor\":\"AWS Graviton2 Processor\",\"clockSpeed\":\"2.5 GHz\",\"ecu\":\"NA\",\"networkPerformance\":\"Up to 10 Gigabit\",\"servicename\":\"Amazon Elastic Compute Cloud\",\"gpuMemory\":\"NA\",\"vpcnetworkingsupport\":\"true\",\"instanceType\":\"m6gd.4xlarge\",\"tenancy\":\"Shared\",\"usagetype\":\"USE2-BoxUsage:m6gd.4xlarge\",\"normalizationSizeFactor\":\"32\",\"intelAvxAvailable\":\"No\",\"servicecode\":\"AmazonEC2\",\"licenseModel\":\"No License required\",\"currentGeneration\":\"Yes\",\"preInstalledSw\":\"NA\",\"location\":\"US East (Ohio)\",\"processorArchitecture\":\"64-bit\",\"marketoption\":\"OnDemand\",\"operation\":\"RunInstances\",\"availabilityzone\":\"NA\"},\"sku\":\"QYPUNNNDFUB78S9D\"},\"serviceCode\":\"AmazonEC2\",\"terms\":{\"OnDemand\":{\"QYPUNNNDFUB78S9D.JRTCKXETXF\":{\"priceDimensions\":{\"QYPUNNNDFUB78S9D.JRTCKXETXF.6YS6EN2CT7\":{\"unit\":\"Hrs\",\"endRange\":\"Inf\",\"description\":\"$0.7232 per On Demand Linux m6gd.4xlarge Instance Hour\",\"appliesTo\":[],\"rateCode\":\"QYPUNNNDFUB78S9D.JRTCKXETXF.6YS6EN2CT7\",\"beginRange\":\"0\",\"pricePerUnit\":{\"USD\":\"0.7232000000\"}}},\"sku\":\"QYPUNNNDFUB78S9D\",\"effectiveDate\":\"2024-09-01T00:00:00Z\",\"offerTermCode\":\"JRTCKXETXF\",\"termAttributes\":{}}},\"Reserved\":{\"QYPUNNNDFUB78S9D.CUZHX8X6JH\":{\"priceDimensions\":{\"QYPUNNNDFUB78S9D.CUZHX8X6JH.6YS6EN2CT7\":{\"unit\":\"Hrs\",\"endRange\":\"Inf\",\"description\":\"Linux/UNIX (Amazon VPC), m6gd.4xlarge reserved instance applied\",\"appliesTo\":[],\"rateCode\":\"QYPUNNNDFUB78S9D.CUZHX8X6JH.6YS6EN2CT7\",\"beginRange\":\"0\",\"pricePerUnit\":{\"USD\":\"0.2508000000\"}},\"QYPUNNNDFUB78S9D.CUZHX8X6JH.2TG2D8R56U\":{\"unit\":\"Quantity\",\"description\":\"Upfront Fee\",\"appliesTo\":[],\"rateCode\":\"QYPUNNNDFUB78S9D.CUZHX8X6JH.2TG2D8R56U\",\"pricePerUnit\":{\"USD\":\"2197\"}}},\"sku\":\"QYPUNNNDFUB78S9D\",\"effectiveDate\":\"2021-02-01T00:00:00Z\",\"offerTermCode\":\"CUZHX8X6JH\",\"termAttributes\":{\"LeaseContractLength\":\"1yr\",\"OfferingClass\":\"convertible\",\"PurchaseOption\":\"Partial Upfront\"}},\"QYPUNNNDFUB78S9D.4NA7Y494T4\":{\"priceDimensions\":{\"QYPUNNNDFUB78S9D.4NA7Y494T4.6YS6EN2CT7\":{\"unit\":\"Hrs\",\"endRange\":\"Inf\",\"description\":\"Linux/UNIX (Amazon VPC), m6gd.4xlarge reserved instance applied\",\"appliesTo\":[],\"rateCode\":\"QYPUNNNDFUB78S9D.4NA7Y494T4.6YS6EN2CT7\",\"beginRange\":\"0\",\"pricePerUnit\":{\"USD\":\"0.4556000000\"}}},\"sku\":\"QYPUNNNDFUB78S9D\",\"effectiveDate\":\"2021-02-01T00:00:00Z\",\"offerTermCode\":\"4NA7Y494T4\",\"termAttributes\":{\"LeaseContractLength\":\"1yr\",\"OfferingClass\":\"standard\",\"PurchaseOption\":\"No Upfront\"}},\"QYPUNNNDFUB78S9D.7NE97W5U4E\":{\"priceDimensions\":{\"QYPUNNNDFUB78S9D.7NE97W5U4E.6YS6EN2CT7\":{\"unit\":\"Hrs\",\"endRange\":\"Inf\",\"description\":\"Linux/UNIX (Amazon VPC), m6gd.4xlarge reserved instance applied\",\"appliesTo\":[],\"rateCode\":\"QYPUNNNDFUB78S9D.7NE97W5U4E.6YS6EN2CT7\",\"beginRange\":\"0\",\"pricePerUnit\":{\"USD\":\"0.5268000000\"}}},\"sku\":\"QYPUNNNDFUB78S9D\",\"effectiveDate\":\"2021-02-01T00:00:00Z\",\"offerTermCode\":\"7NE97W5U4E\",\"termAttributes\":{\"LeaseContractLength\":\"1yr\",\"OfferingClass\":\"convertible\",\"PurchaseOption\":\"No Upfront\"}},\"QYPUNNNDFUB78S9D.R5XV2EPZQZ\":{\"priceDimensions\":{\"QYPUNNNDFUB78S9D.R5XV2EPZQZ.2TG2D8R56U\":{\"unit\":\"Quantity\",\"description\":\"Upfront Fee\",\"appliesTo\":[],\"rateCode\":\"QYPUNNNDFUB78S9D.R5XV2EPZQZ.2TG2D8R56U\",\"pricePerUnit\":{\"USD\":\"4401\"}},\"QYPUNNNDFUB78S9D.R5XV2EPZQZ.6YS6EN2CT7\":{\"unit\":\"Hrs\",\"endRange\":\"Inf\",\"description\":\"Linux/UNIX (Amazon VPC), m6gd.4xlarge reserved instance applied\",\"appliesTo\":[],\"rateCode\":\"QYPUNNNDFUB78S9D.R5XV2EPZQZ.6YS6EN2CT7\",\"beginRange\":\"0\",\"pricePerUnit\":{\"USD\":\"0.1675000000\"}}},\"sku\":\"QYPUNNNDFUB78S9D\",\"effectiveDate\":\"2021-02-01T00:00:00Z\",\"offerTermCode\":\"R5XV2EPZQZ\",\"termAttributes\":{\"LeaseContractLength\":\"3yr\",\"OfferingClass\":\"convertible\",\"PurchaseOption\":\"Partial Upfront\"}},\"QYPUNNNDFUB78S9D.38NPMPTW36\":{\"priceDimensions\":{\"QYPUNNNDFUB78S9D.38NPMPTW36.6YS6EN2CT7\":{\"unit\":\"Hrs\",\"endRange\":\"Inf\",\"description\":\"Linux/UNIX (Amazon VPC), m6gd.4xlarge reserved instance applied\",\"appliesTo\":[],\"rateCode\":\"QYPUNNNDFUB78S9D.38NPMPTW36.6YS6EN2CT7\",\"beginRange\":\"0\",\"pricePerUnit\":{\"USD\":\"0.1446000000\"}},\"QYPUNNNDFUB78S9D.38NPMPTW36.2TG2D8R56U\":{\"unit\":\"Quantity\",\"description\":\"Upfront Fee\",\"appliesTo\":[],\"rateCode\":\"QYPUNNNDFUB78S9D.38NPMPTW36.2TG2D8R56U\",\"pricePerUnit\":{\"USD\":\"3801\"}}},\"sku\":\"QYPUNNNDFUB78S9D\",\"effectiveDate\":\"2021-02-01T00:00:00Z\",\"offerTermCode\":\"38NPMPTW36\",\"termAttributes\":{\"LeaseContractLength\":\"3yr\",\"OfferingClass\":\"standard\",\"PurchaseOption\":\"Partial Upfront\"}},\"QYPUNNNDFUB78S9D.VJWZNREJX2\":{\"priceDimensions\":{\"QYPUNNNDFUB78S9D.VJWZNREJX2.2TG2D8R56U\":{\"unit\":\"Quantity\",\"description\":\"Upfront Fee\",\"appliesTo\":[],\"rateCode\":\"QYPUNNNDFUB78S9D.VJWZNREJX2.2TG2D8R56U\",\"pricePerUnit\":{\"USD\":\"4307\"}},\"QYPUNNNDFUB78S9D.VJWZNREJX2.6YS6EN2CT7\":{\"unit\":\"Hrs\",\"endRange\":\"Inf\",\"description\":\"USD 0.0 per Linux/UNIX (Amazon VPC), m6gd.4xlarge reserved instance applied\",\"appliesTo\":[],\"rateCode\":\"QYPUNNNDFUB78S9D.VJWZNREJX2.6YS6EN2CT7\",\"beginRange\":\"0\",\"pricePerUnit\":{\"USD\":\"0.0000000000\"}}},\"sku\":\"QYPUNNNDFUB78S9D\",\"effectiveDate\":\"2021-02-01T00:00:00Z\",\"offerTermCode\":\"VJWZNREJX2\",\"termAttributes\":{\"LeaseContractLength\":\"1yr\",\"OfferingClass\":\"convertible\",\"PurchaseOption\":\"All Upfront\"}},\"QYPUNNNDFUB78S9D.HU7G6KETJZ\":{\"priceDimensions\":{\"QYPUNNNDFUB78S9D.HU7G6KETJZ.6YS6EN2CT7\":{\"unit\":\"Hrs\",\"endRange\":\"Inf\",\"description\":\"Linux/UNIX (Amazon VPC), m6gd.4xlarge reserved instance applied\",\"appliesTo\":[],\"rateCode\":\"QYPUNNNDFUB78S9D.HU7G6KETJZ.6YS6EN2CT7\",\"beginRange\":\"0\",\"pricePerUnit\":{\"USD\":\"0.2170000000\"}},\"QYPUNNNDFUB78S9D.HU7G6KETJZ.2TG2D8R56U\":{\"unit\":\"Quantity\",\"description\":\"Upfront Fee\",\"appliesTo\":[],\"rateCode\":\"QYPUNNNDFUB78S9D.HU7G6KETJZ.2TG2D8R56U\",\"pricePerUnit\":{\"USD\":\"1901\"}}},\"sku\":\"QYPUNNNDFUB78S9D\",\"effectiveDate\":\"2021-02-01T00:00:00Z\",\"offerTermCode\":\"HU7G6KETJZ\",\"termAttributes\":{\"LeaseContractLength\":\"1yr\",\"OfferingClass\":\"standard\",\"PurchaseOption\":\"Partial Upfront\"}},\"QYPUNNNDFUB78S9D.BPH4J8HBKS\":{\"priceDimensions\":{\"QYPUNNNDFUB78S9D.BPH4J8HBKS.6YS6EN2CT7\":{\"unit\":\"Hrs\",\"endRange\":\"Inf\",\"description\":\"Linux/UNIX (Amazon VPC), m6gd.4xlarge reserved instance applied\",\"appliesTo\":[],\"rateCode\":\"QYPUNNNDFUB78S9D.BPH4J8HBKS.6YS6EN2CT7\",\"beginRange\":\"0\",\"pricePerUnit\":{\"USD\":\"0.3124000000\"}}},\"sku\":\"QYPUNNNDFUB78S9D\",\"effectiveDate\":\"2021-02-01T00:00:00Z\",\"offerTermCode\":\"BPH4J8HBKS\",\"termAttributes\":{\"LeaseContractLength\":\"3yr\",\"OfferingClass\":\"standard\",\"PurchaseOption\":\"No Upfront\"}},\"QYPUNNNDFUB78S9D.NQ3QZPMQV9\":{\"priceDimensions\":{\"QYPUNNNDFUB78S9D.NQ3QZPMQV9.6YS6EN2CT7\":{\"unit\":\"Hrs\",\"endRange\":\"Inf\",\"description\":\"USD 0.0 per Linux/UNIX (Amazon VPC), m6gd.4xlarge reserved instance applied\",\"appliesTo\":[],\"rateCode\":\"QYPUNNNDFUB78S9D.NQ3QZPMQV9.6YS6EN2CT7\",\"beginRange\":\"0\",\"pricePerUnit\":{\"USD\":\"0.0000000000\"}},\"QYPUNNNDFUB78S9D.NQ3QZPMQV9.2TG2D8R56U\":{\"unit\":\"Quantity\",\"description\":\"Upfront Fee\",\"appliesTo\":[],\"rateCode\":\"QYPUNNNDFUB78S9D.NQ3QZPMQV9.2TG2D8R56U\",\"pricePerUnit\":{\"USD\":\"7146\"}}},\"sku\":\"QYPUNNNDFUB78S9D\",\"effectiveDate\":\"2021-02-01T00:00:00Z\",\"offerTermCode\":\"NQ3QZPMQV9\",\"termAttributes\":{\"LeaseContractLength\":\"3yr\",\"OfferingClass\":\"standard\",\"PurchaseOption\":\"All Upfront\"}},\"QYPUNNNDFUB78S9D.6QCMYABX3D\":{\"priceDimensions\":{\"QYPUNNNDFUB78S9D.6QCMYABX3D.6YS6EN2CT7\":{\"unit\":\"Hrs\",\"endRange\":\"Inf\",\"description\":\"USD 0.0 per Linux/UNIX (Amazon VPC), m6gd.4xlarge reserved instance applied\",\"appliesTo\":[],\"rateCode\":\"QYPUNNNDFUB78S9D.6QCMYABX3D.6YS6EN2CT7\",\"beginRange\":\"0\",\"pricePerUnit\":{\"USD\":\"0.0000000000\"}},\"QYPUNNNDFUB78S9D.6QCMYABX3D.2TG2D8R56U\":{\"unit\":\"Quantity\",\"description\":\"Upfront Fee\",\"appliesTo\":[],\"rateCode\":\"QYPUNNNDFUB78S9D.6QCMYABX3D.2TG2D8R56U\",\"pricePerUnit\":{\"USD\":\"3725\"}}},\"sku\":\"QYPUNNNDFUB78S9D\",\"effectiveDate\":\"2021-02-01T00:00:00Z\",\"offerTermCode\":\"6QCMYABX3D\",\"termAttributes\":{\"LeaseContractLength\":\"1yr\",\"OfferingClass\":\"standard\",\"PurchaseOption\":\"All Upfront\"}},\"QYPUNNNDFUB78S9D.MZU6U2429S\":{\"priceDimensions\":{\"QYPUNNNDFUB78S9D.MZU6U2429S.2TG2D8R56U\":{\"unit\":\"Quantity\",\"description\":\"Upfront Fee\",\"appliesTo\":[],\"rateCode\":\"QYPUNNNDFUB78S9D.MZU6U2429S.2TG2D8R56U\",\"pricePerUnit\":{\"USD\":\"8626\"}},\"QYPUNNNDFUB78S9D.MZU6U2429S.6YS6EN2CT7\":{\"unit\":\"Hrs\",\"endRange\":\"Inf\",\"description\":\"USD 0.0 per Linux/UNIX (Amazon VPC), m6gd.4xlarge reserved instance applied\",\"appliesTo\":[],\"rateCode\":\"QYPUNNNDFUB78S9D.MZU6U2429S.6YS6EN2CT7\",\"beginRange\":\"0\",\"pricePerUnit\":{\"USD\":\"0.0000000000\"}}},\"sku\":\"QYPUNNNDFUB78S9D\",\"effectiveDate\":\"2021-02-01T00:00:00Z\",\"offerTermCode\":\"MZU6U2429S\",\"termAttributes\":{\"LeaseContractLength\":\"3yr\",\"OfferingClass\":\"convertible\",\"PurchaseOption\":\"All Upfront\"}},\"QYPUNNNDFUB78S9D.Z2E3P23VKM\":{\"priceDimensions\":{\"QYPUNNNDFUB78S9D.Z2E3P23VKM.6YS6EN2CT7\":{\"unit\":\"Hrs\",\"endRange\":\"Inf\",\"description\":\"Linux/UNIX (Amazon VPC), m6gd.4xlarge reserved instance applied\",\"appliesTo\":[],\"rateCode\":\"QYPUNNNDFUB78S9D.Z2E3P23VKM.6YS6EN2CT7\",\"beginRange\":\"0\",\"pricePerUnit\":{\"USD\":\"0.3617000000\"}}},\"sku\":\"QYPUNNNDFUB78S9D\",\"effectiveDate\":\"2021-02-01T00:00:00Z\",\"offerTermCode\":\"Z2E3P23VKM\",\"termAttributes\":{\"LeaseContractLength\":\"3yr\",\"OfferingClass\":\"convertible\",\"PurchaseOption\":\"No Upfront\"}}}},\"version\":\"20240925190622\",\"publicationDate\":\"2024-09-25T19:06:22Z\"}";
	
	public static void main(String[] args) throws Exception{
		Path ruta = Paths.get("C:\\Users\\user\\git\\infodigg\\deploy-all\\analisis_cad\\precios.txt");
		Path rutaOut = Paths.get("C:\\Users\\user\\git\\infodigg\\deploy-all\\analisis_cad\\precios_out.txt");
		
		List<String> lines = Files.readAllLines(ruta);
		
		
		List<String> outputLines = new ArrayList<String>(); 
		for(String str : lines) {
			if (StringUtils.isNotBlank(str)) {
				ObjectMapper mapper = new ObjectMapper();
				AwsPriceElement elem = mapper.readValue(str.getBytes(StandardCharsets.UTF_8), AwsPriceElement.class);
				outputLines.add(elem.toString());
				
			}
		}
		
		Files.deleteIfExists(rutaOut);
		Files.write(rutaOut, outputLines, StandardOpenOption.CREATE);		
		
	}

	
}
